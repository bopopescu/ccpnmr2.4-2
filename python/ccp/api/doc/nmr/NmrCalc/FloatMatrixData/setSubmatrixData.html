
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<!--Generated by PyApiDocGen on Mon Mar  2 17:25:12 2015-->
<!--======================COPYRIGHT/LICENSE START==========================

index.html: Python API documentation for CCPN data model, package ccp.nmr.NmrCalc

Copyright (C) 2007 Rasmus Fogh (CCPN Project)

=======================================================================
The license for this file is in ../../../../../../../..license/LGPL.license
======================COPYRIGHT/LICENSE END============================

for further information, please contact :

- CCPN website (http://www.ccpn.ac.uk/)

- email: ccpn@bioc.cam.ac.uk

=======================================================================
===========================REFERENCE START=============================
===========================REFERENCE END===============================
-->
<HTML>
<head>
  <title>CCPN Python API Method: ccp.api.nmr.NmrCalc.FloatMatrixData.setSubmatrixData</title>
  <link rel=stylesheet type="text/css" href="../../../../../../../doc/htmldoc.css">
  <script language="JavaScript">
    function wopn(href){ window.open(href,'','width=880,height=500,top=300,left=300,resizable=0,toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1')}
  </script>
</head>
<body>
<table bgcolor="#F0CC99" border="0" height="100" width="100%">
  <tr>
    <td>
      <a href="http://www.ccpn.ac.uk/" class="mainlogo"><img  alt="CCPN" border="0" id="toplink" src="../../../../../../../doc/graphics/CCPN_Logo_200_x.gif"/></a>
      <br>
      &nbsp;&nbsp;&nbsp;
      Data Model version 2.1.2
    </td>
    <td valign="center" width="80%">
      <!-- TOP BANNER BEGIN-->
      <div class="topbanner">
        <table border="0" width="100%">
          <tr valign="top">
            <td align="right" width="80%">
              <a href="javascript:wopn('../../../../../../../doc/acknowledgements.html')">Acknowledgements</a>
            </td>
          </tr>
          <tr>
            <td align="center">
              <a href="../../../../../../../model/doc/ccp/nmr/NmrCalc.html">Diagram</a>
              |
              <a href="../../../../../../../python/doc/classMap.html">Class Map</a>
              |
              <a href="../../../../../../../python/doc/attributeMap.html">Attribute Map</a>
              |
              <a href="../../../../../../../python/doc/methodMap.html">Method Map</a>
              |
              <a href="javascript:wopn('../../../../../../../doc/help.html')">Help</a>
              |
              <a href="javascript:wopn('../../../../../../../doc/license.html')">License</a>
            </td>
          </tr>
          <tr valign="top">
            <td align="center" valign="bottom">
              <a href="../../../../../../../python/doc/api.html">Home</a>
              |
              <a href="../../../../../../../python/ccp/api/doc/nmr/NmrCalc/index.html">Package</a>
              |
              <a href="../../../../../../../python/ccp/api/doc/nmr/NmrCalc/FloatMatrixData/index.html">Class</a>
              |
              Attribute
              |
              <span class="underover">
              Method:
              </span>
              {
              <a href="../../../../../../../python/ccp/api/doc/nmr/NmrCalc/FloatMatrixData/setPointValue.html">prev</a>
              |
              <a href="../../../../../../../python/ccp/api/doc/nmr/NmrCalc/FloatMatrixData/sizeFirstDim.html">next</a>
              }
            </td>
          </tr>
          <tr>
            <td>
            </td>
          </tr>
        </table>
      </div>
      <!-- TOP BANNER END-->
    </td>
  </tr>
</table>
<table cellpadding="5" width="100%">
  <tr>
    <td>
      <h2>Method: setSubmatrixData</h2>
      <ul>
      <h3>from Class <a href="index.html">ccp.api.nmr.NmrCalc.FloatMatrixData</a></h3>
      </ul>
      <br>
      <ul>
      set data for submatrix of shape 'shape' with 'point' as the corner with the smallest index values to 'values' (packed linear array). Point is converted as for self.pointToIndex.&nbsp;&nbsp;shape values that are omitted or set to zero are reset to the (rest of the) dimension size.
      </ul>
      <br>
      <table cellpadding="2" cellspacing="2">
        <tr>
          <td>
            guid:
          </td>
          <td>
            www.ccpn.ac.uk_Fogh_2011-03-30-18:05:06_00023__www.ccpn.ac.uk_Fogh_2011-04-05-18:08:58_00001
          </td>
        </tr>
        <tr>
          <td>
            OpType:
          </td>
          <td>
            otherModify
          </td>
        </tr>
        <tr>
          <td>
            OpSubType:
          </td>
          <td>
            None
          </td>
        </tr>
        <tr>
          <td>
            isQuery:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            isAbstract:
          </td>
          <td>
            False
          </td>
        </tr>
        <tr>
          <td>
            Scope:
          </td>
          <td>
            instance_level
          </td>
        </tr>
        <tr>
          <td valign="top">
            Code:
          </td>
          <td valign="top">
            # get starting offset and normalise point -<br>
            # padding with zero and converting to positive indices<br>
            offset = self.pointToIndex(point)<br>
            point = self.indexToPoint(offset)<br>
            <br>
            # set up internal params<br>
            ndim = self.ndim<br>
            sizes = self.shape<br>
            <br>
            # set widths and check<br>
            shape = list(shape)<br>
            if len(shape) &gt; ndim:<br>
            &nbsp;&nbsp;raise ApiError(&quot;Number of submatrix dimensions %s exceeds ndim %s&quot; % (shape,ndim))<br>
            for ii,width in enumerate(shape):<br>
            &nbsp;&nbsp;if not width:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;shape[ii] = sizes[ii] - point[ii]<br>
            &nbsp;&nbsp;elif width &lt; 0 or width &gt; sizes[ii] - point[ii]:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;raise ApiError(&quot;Size %s in dim %s out of permitted range&quot; % (width,ii))<br>
            # Extend shape, padding to dimension sizes.<br>
            shape.extend(sizes[ii] - point[ii] for ii in range(len(shape),ndim))<br>
            <br>
            # set up strides list and lowest dim with continuous data.<br>
            strides = ndim*[0]<br>
            factor = 1<br>
            dodim = 0<br>
            for ii in range(ndim-1,-1,-1):<br>
            &nbsp;&nbsp;strides[ii] = factor<br>
            &nbsp;&nbsp;factor *= sizes[ii]<br>
            &nbsp;&nbsp;if not dodim and shape[ii] != sizes[ii]:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;dodim = ii<br>
            <br>
            # length of contiguous stretch<br>
            stretch = strides[dodim] * shape[dodim]<br>
            <br>
            # get hold of data (must bypass API for speed)<br>
            data = self.__dict__['data'] <br>
            if not data:<br>
            &nbsp;&nbsp;data.extend(self.size*[self.defaultValue])<br>
            <br>
            # check value types<br>
            if [x for x in values if not isinstance(x,(float,int))]:<br>
            &nbsp;&nbsp;raise ApiError(&quot;Non-numeric values passed to setSubmatrixData: %s&quot; %&nbsp;&nbsp;list(set(x for x in values if not isinstance(x,(float,int)))))<br>
            <br>
            if dodim &lt;= 0:<br>
            &nbsp;&nbsp;# set single stretch from 1D array<br>
            &nbsp;&nbsp;data[offset:offset+stretch] =values<br>
            &nbsp;&nbsp;<br>
            else:<br>
            &nbsp;&nbsp;# do work for ndim array<br>
            &nbsp;&nbsp;<br>
            &nbsp;&nbsp;# check length and type of values<br>
            &nbsp;&nbsp;import operator<br>
            &nbsp;&nbsp;subsize = reduce(operator.mul, shape)<br>
            &nbsp;&nbsp;if len(values) != subsize:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;raise ApiError(&quot;Number of values %s do not fit submatrix shape %s&quot; % (subsize, shape))<br>
            &nbsp;&nbsp;<br>
            &nbsp;&nbsp;# set up multidimensional loop<br>
            &nbsp;&nbsp;vector = (dodim)*[0]<br>
            &nbsp;&nbsp;dim = dim0 = dodim - 1<br>
            &nbsp;&nbsp;target = 0<br>
            &nbsp;&nbsp;while dim &gt;= 0:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;# do actual work<br>
            &nbsp;&nbsp;&nbsp;&nbsp;next = target+stretch<br>
            &nbsp;&nbsp;&nbsp;&nbsp;data[offset:offset+stretch] = values[target:next] <br>
            &nbsp;&nbsp;&nbsp;&nbsp;target = next<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;# update reading offset<br>
            &nbsp;&nbsp;&nbsp;&nbsp;vector[dim] += 1<br>
            &nbsp;&nbsp;&nbsp;&nbsp;if vector[dim] &lt; shape[dim]:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset += strides[dim]<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if dim &lt; dim0:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dim += 1<br>
            &nbsp;&nbsp;&nbsp;&nbsp;else:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vector[dim] = 0<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dim -=1
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>


<table width="100%" cellpadding=2>
  <tr><td colspan=2 width="100%" bgcolor=#794E83></td></tr>
  <tr>
    <td><h5>
    
      &nbsp;
    <em>Data Model Version</em>&nbsp;2.1.2
    </h5></td>
    <td align=right><a href='#toplink'><span style="font-size:9pt">Go&nbsp;to&nbsp;Top&nbsp;&nbsp;</span></a>
    </td>
  </tr>
</table>

<div class="leftbanner">
<table width=100% cellspacing=0 cellpadding=2 border=0>
  <tr><td bgcolor=#794E83>
    <nobr>
    <em>&nbsp;&nbsp;Autogenerated by</em>&nbsp;&nbsp;PyApiDocGen&nbsp;
    <em>revision</em>&nbsp;1.3&nbsp;&nbsp;
    <em>on</em>&nbsp;&nbsp;Mon Mar  2 17:25:12 2015&nbsp;</nobr>
    <nobr>&nbsp;
    <em>from data model package</em>&nbsp;&nbsp;ccp.api.nmr.NmrCalc.FloatMatrixData&nbsp;&nbsp;
    <em>revision</em>&nbsp;?&nbsp;&nbsp;</nobr>
  </td></tr>
</table>
</div>
<table width=100% cellspacing=0 cellpadding=2 border=0>
  <tr valign=top>
    <td><h6>&nbsp;&nbsp;Work done by the <a href="mailto:ccpn-dev@mole.bio.cam.ac.uk">CCPN team</a>.</h6></td>
    <td align=right><h6><a target="blank" href="http://www.ccpn.ac.uk">www.ccpn.ac.uk</a>&nbsp;&nbsp;</h6></td>
  </tr>
</table>
<br>

</body>
</HTML>
